<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Augusta Sand & Gravel — iPhone</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#000000">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand-yellow: #FACC15; --brand-black: #000; }
    body { -webkit-tap-highlight-color: transparent; }
    #splash { position: fixed; inset: 0; background: #000; display: flex;
      align-items: center; justify-content: center; z-index: 50; transition: opacity .4s ease; }
    #splash img { width: 96px; height: 96px; }
    #splash.hide { opacity: 0; pointer-events: none; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="splash" aria-hidden="true">
    <img src="./icons/asg-icon-384.png" alt="Augusta Sand & Gravel">
  </div>

  <div class="min-h-screen p-3 sm:p-4 max-w-xl mx-auto">
    <header class="mb-3 rounded-2xl bg-black text-[var(--brand-yellow)] p-3 flex items-center gap-3 shadow">
      <div class="text-xl font-semibold leading-tight">Augusta Sand & Gravel</div>
    </header>

    <div id="asgCalendar"></div>

    <div class="mt-2 grid grid-cols-1 gap-2">
      <div class="flex gap-2 items-center">
        <label class="text-sm text-gray-700">Hub</label>
        <select id="hubSelect" class="flex-1 rounded-xl border px-3 py-2"></select>
      </div>
    </div>

    <div class="flex gap-2 my-3">
      <button data-tab="today" class="tab px-3 py-2 rounded-xl border">Today</button>
      <button data-tab="tomorrow" class="tab px-3 py-2 rounded-xl border">Tomorrow</button>
      <button data-tab="week" class="tab px-3 py-2 rounded-xl border">This Week</button>
      <button data-tab="all" class="tab px-3 py-2 rounded-xl border">All</button>
    </div>

    <div class="bg-white rounded-2xl shadow p-3 mb-3">
      <div class="grid grid-cols-2 gap-2">
        <input id="date" class="rounded-xl border px-3 py-2" placeholder="Date" />
        <input id="time" class="rounded-xl border px-3 py-2" placeholder="Time" />
        <input id="customer" class="rounded-xl border px-3 py-2 col-span-2" placeholder="Customer" />
        <input id="address" class="rounded-xl border px-3 py-2 col-span-2" placeholder="Address" />
        <select id="material" class="rounded-xl border px-3 py-2">
          <option>Crush & Run</option><option>#57 Stone</option><option>Clean Sand</option><option>Sand Clay</option><option>Fill Dirt</option><option>Top Soil</option><option>#4 Stone</option>
        </select>
        <select id="loadSize" class="rounded-xl border px-3 py-2"></select>
        <input id="price" class="rounded-xl border px-3 py-2" placeholder="Price" />
        <select id="status" class="rounded-xl border px-3 py-2"><option>Scheduled</option><option>In Progress</option><option>Complete</option><option>Canceled</option></select>
      </div>
      <div class="mt-2 flex gap-2">
        <button id="addJobBtn" class="rounded-xl px-4 py-2 text-black" style="background:var(--brand-yellow)">Add Job</button>
      </div>
    </div>

    <!-- Calendar (integrated) -->
<section id="asgCalendar" class="mb-3">
  <div class="bg-white rounded-2xl shadow border">
    <div class="flex items-center justify-between p-3 border-b">
      <button id="calPrev" class="rounded-xl border px-3 py-1">◀</button>
      <div class="text-base font-semibold" id="calTitle">Month</div>
      <div class="flex items-center gap-2">
        <button id="calToday" class="rounded-xl border px-3 py-1">Today</button>
        <button id="calNext" class="rounded-xl border px-3 py-1">▶</button>
      </div>
    </div>
    <div class="grid grid-cols-7 text-center text-xs font-semibold text-gray-600 px-3 pt-2">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div id="calGrid" class="grid grid-cols-7 gap-1 p-3 pb-2"></div>
    <div id="calDayShelf" class="border-t p-3 hidden">
      <div class="flex items-center justify-between">
        <div class="font-semibold" id="calDayLabel">Jobs</div>
        <div class="text-xs text-gray-500" id="calDayCounts"></div>
      </div>
      <div id="calDayJobs" class="mt-2 space-y-2"></div>
    </div>
  </div>
</section>

<!-- Jobs list -->
<div id="list" class="space-y-2"></div>
  </div>

<script>
let jobs = JSON.parse(localStorage.getItem('dt_jobs')||'[]');
function saveJobs(){ localStorage.setItem('dt_jobs', JSON.stringify(jobs)); }

function renderList(){
  const list=document.getElementById('list');
  list.innerHTML='';
  jobs.forEach(job=>{
    const card=document.createElement('div');
    card.className='bg-white rounded-2xl shadow p-3';
    card.innerHTML=`
      <div class="flex justify-between">
        <div>
          <div class="font-medium">${job.customer}</div>
          <div class="text-sm text-gray-600">${job.date} ${job.time}</div>
          <div class="text-sm">${job.address}</div>
          <div class="text-xs text-gray-600">${job.material} • ${job.loadSize} • $${job.price}</div>
        </div>
        <div class="flex flex-col gap-1">
          <button class="editBtn rounded-xl border px-2 py-1 text-sm" data-id="${job.id}">Edit</button>
          <button class="delBtn text-red-600 text-sm" data-id="${job.id}">Delete</button>
        </div>
      </div>`;
    list.appendChild(card);
  });
  document.querySelectorAll('.editBtn').forEach(btn=>{
    btn.onclick=()=>openEdit(btn.dataset.id);
  });
  document.querySelectorAll('.delBtn').forEach(btn=>{
    btn.onclick=()=>{jobs=jobs.filter(j=>j.id!==btn.dataset.id);saveJobs();renderList();};
  });
}

function openEdit(id){
  const j=jobs.find(x=>x.id===id);
  if(!j) return;
  const date=prompt('Date',j.date); if(!date) return;
  j.date=date;
  j.time=prompt('Time',j.time)||j.time;
  j.customer=prompt('Customer',j.customer)||j.customer;
  j.address=prompt('Address',j.address)||j.address;
  j.material=prompt('Material',j.material)||j.material;
  j.loadSize=prompt('Load Size',j.loadSize)||j.loadSize;
  j.price=prompt('Price',j.price)||j.price;
  j.status=prompt('Status',j.status)||j.status;
  saveJobs();renderList();
}

function addJob(){
  const id=String(Date.now());
  jobs.push({id,date:date.value,time:time.value,customer:customer.value,address:address.value,material:material.value,loadSize:loadSize.value,price:price.value,status:status.value});
  saveJobs();renderList();
}

addJobBtn.onclick=addJob;
renderList();
</script>

<script>
// Simple calendar integration
(function(){
  const container=document.getElementById('asgCalendar');
  const today=new Date();
  container.innerHTML='<div class="bg-white rounded-2xl shadow p-3">Calendar placeholder — future month grid here</div>';
})();
</script>
<script>
// Delegated Edit handler: works even if buttons are rendered later
(function(){
  function handleEditClick(target){
    const btn = target.closest('[data-edit-id],[data-action="edit"],button');
    if (!btn) return;
    const id = btn.getAttribute('data-edit-id') || btn.getAttribute('data-id');
    if (!id) {
      // fall back: match visible 'Edit' buttons in job cards
      const isEdit = (btn.textContent||'').trim() === 'Edit';
      if (!isEdit) return;
      const card = btn.closest('[data-id]');
      if (!card) return;
      const cid = card.getAttribute('data-id');
      if (!cid) return;
      return openById(cid);
    }
    return openById(id);
  }
  function openById(jobId){
    const j = (window.jobs||[]).find(x=>x.id===jobId);
    if (j && window.openEdit) window.openEdit(j);
  }
  document.addEventListener('click', function(e){ handleEditClick(e.target); }, {passive:true});
})();
</script>
<script>
// Integrated Calendar logic
(function(){
  if (window.__asgCalendarLoaded) return; window.__asgCalendarLoaded = true;
  const $=s=>document.querySelector(s); const pad2=n=>String(n).padStart(2,'0');
  const ymd=d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; const addDays=(d,n)=>{const x=new Date(d); x.setDate(x.getDate()+n); return x;};
  const grid=$('#calGrid'), title=$('#calTitle'), shelf=$('#calDayShelf'), dayLabel=$('#calDayLabel'), dayJobs=$('#calDayJobs'), dayCounts=$('#calDayCounts');
  function monthMatrix(y,m){ const first=new Date(y,m,1); const start=addDays(first,-first.getDay()); const cells=[]; for(let i=0;i<42;i++) cells.push(addDays(start,i)); return cells; }
  function jobsByDate(){ const map={}; (window.jobs||[]).forEach(j=>{ const d=j.date||''; if(!d) return; (map[d]||(map[d]=[])).push(j); }); return map; }
  let viewDate=new Date();
  function renderCal(){ if(!grid||!title) return; const y=viewDate.getFullYear(), m=viewDate.getMonth(), now=new Date(); title.textContent=viewDate.toLocaleDateString(undefined,{month:'long',year:'numeric'});
    const matrix=monthMatrix(y,m), by=jobsByDate(); grid.innerHTML='';
    matrix.forEach(d=>{ const other=d.getMonth()!==m, today=ymd(d)===ymd(now), key=ymd(d), jobs=by[key]||[];
      const el=document.createElement('button'); el.type='button'; el.className=['rounded-xl px-2 py-1 text-left h-16 border', other?'bg-gray-50 text-gray-400':'bg-white', today?'ring-2 ring-black':''].join(' ');
      const count=jobs.length, scheduled=jobs.filter(j=>j.status==='Scheduled').length, inprog=jobs.filter(j=>j.status==='In Progress').length, complete=jobs.filter(j=>j.status==='Complete').length;
      el.innerHTML=`<div class=\"flex items-start justify-between\"><div class=\"text-sm font-semibold\">${d.getDate()}</div>${count?`<span class=\"text-[10px] px-1.5 rounded-full bg-black text-white\">${count}</span>`:''}</div>
      <div class=\"mt-1 flex gap-1\">${scheduled?`<span class=\"inline-block w-2 h-2 rounded-full bg-blue-500\" title=\"Scheduled: ${scheduled}\"></span>`:''}${inprog?`<span class=\"inline-block w-2 h-2 rounded-full bg-yellow-500\" title=\"In Progress: ${inprog}\"></span>`:''}${complete?`<span class=\"inline-block w-2 h-2 rounded-full bg-green-500\" title=\"Complete: ${complete}\"></span>`:''}</div>`;
      el.addEventListener('click',()=>openDay(key)); el.addEventListener('dblclick',()=>{ const di=document.getElementById('date'); if(di) di.value=key; const cust=document.getElementById('customer'); if(cust) cust.focus(); window.scrollTo({top:0,behavior:'smooth'}); }); grid.appendChild(el);
    });
  }
  function openDay(ds){ if(!shelf) return; dayLabel.textContent=`Jobs on ${ds}`; const items=(window.jobs||[]).filter(j=>j.date===ds); const s=items.filter(j=>j.status==='Scheduled').length, ip=items.filter(j=>j.status==='In Progress').length, c=items.filter(j=>j.status==='Complete').length, x=items.filter(j=>j.status==='Canceled').length; dayCounts.textContent=`${items.length} total • S:${s} • IP:${ip} • C:${c} • X:${x}`; dayJobs.innerHTML=''; if(!items.length){ dayJobs.innerHTML='<div class="text-gray-500 text-sm">No jobs on this day.</div>'; } else { items.sort((a,b)=> (a.time||'').localeCompare(b.time||'')); items.forEach(j=>{ const card=document.createElement('div'); card.className='rounded-xl border p-2'; card.innerHTML=`<div class=\"flex items-center justify-between\"><div class=\"font-medium text-sm\">${j.customer||'(No name)'} <span class=\"ml-2 text-xs px-2 py-0.5 rounded bg-gray-100\">${j.status||'Scheduled'}</span></div><button class=\"text-xs underline\" data-action=\"edit\" data-edit-id=\"${j.id}\">Edit</button></div><div class=\"text-xs text-gray-600\">${j.time||''} • ${j.material||''}${j.loadSize?` • ${j.loadSize}`:''}</div><div class=\"text-xs\">${j.address||''}</div>`; dayJobs.appendChild(card); }); }
    shelf.classList.remove('hidden'); const di=document.getElementById('date'); if(di) di.value=ds; }
  document.getElementById('calPrev')?.addEventListener('click',()=>{ viewDate.setMonth(viewDate.getMonth()-1); renderCal(); });
  document.getElementById('calNext')?.addEventListener('click',()=>{ viewDate.setMonth(viewDate.getMonth()+1); renderCal(); });
  document.getElementById('calToday')?.addEventListener('click',()=>{ viewDate=new Date(); renderCal(); openDay(ymd(new Date())); });
  const origSave=window.saveJobs||function(){}; window.saveJobs=function(){ origSave.apply(this,arguments); renderCal(); };
  const origRender=window.renderList||function(){}; window.renderList=function(){ origRender.apply(this,arguments); renderCal(); };
  renderCal();
})();
</script>

</body>
</html>
